---
import MainLayout from "@core/layouts/MainLayout.astro"
import properties from "@features/properties/data/properties.json"
import PropertyGallery from "@features/properties/components/PropertyGallery.astro"
import { CLIENT_URL } from "astro:env/client"
import { getWhatsappLink } from "src/utils/whatsapp"
import Button from "@core/ui/Button.astro"

export async function getStaticPaths() {
	return properties.map((prop) => ({
		params: { slug: prop.slug },
		props: { property: prop },
	}))
}

const { property } = Astro.props

const message = `Hola, estoy interesado en esta propiedad. Me gustaría obtener más información.`
const url = `${CLIENT_URL}/propiedades/${property?.slug}`

const metadata = {
	title: property?.title || "Propiedad",
	description: property?.description || "Descripción de la propiedad",
	url: url,
	image: property?.images[0].src || "/default-image.jpg",
}
---

<MainLayout
	title={metadata.title}
	description={metadata.description}
	image={metadata.image}
	url={metadata.url}
	whatsappMessage={message}
>
	<div class="h-14 lg:h-[66px] sticky top-0 w-full bg-midnight-blue z-10"></div>

	<header>
		<div class="container py-4 overflow-hidden">
			<a
				href="/"
				class="py-1 px-1.5 rounded inline-flex items-center gap-2 text-dark-orange font-semibold hover:bg-gray-100 transition"
			>
				<i class="fa-solid fa-chevron-left text-xs"></i>
				<span class="text-sm">Regresar</span>
			</a>

			<!-- Title and location -->
			<div class="mt-4 mb-2">
				<h1 class="text-xl md:text-3xl lg:text-3xl font-semibold text-midnight-blue mb-2">{property?.title}</h1>
				<div class="flex items-center text-gray-500">
					<i class="fas fa-map-marker-alt text-gray-700 mr-2"></i>
					<span>{property?.location}</span>
				</div>
			</div>
		</div>
	</header>

	<PropertyGallery images={property.images} />

	<!-- Property Info -->
	<section class="container grid grid-cols-1 lg:grid-cols-[1fr_380px] gap-8">
		<div class="l2">
			<!-- Price -->
			<div>
				<p class="text-gray-600 mb-1">Precio de venta</p>
				<p class="text-2xl md:text-3xl font-bold text-midnight-blue mb-4">{property?.price}</p>
			</div>

			<!-- Features -->
			<div class="bg-white rounded-lg p-5 mb-8 border-2 border-gray-100/80">
				<div class="grid grid-cols-2 md:grid-cols-4 gap-4">
					<div class="flex gap-2 items-center">
						<div class="bg-gray-100/90 size-12 flex items-center justify-center rounded-md">
							<i class="fas fa-ruler-combined text-cornflower-blue text-xl"></i>
						</div>
						<div>
							<p class="text-sm text-gray-600">Área total</p>
							<p class="font-bold text-midnight-blue">{property?.area} m²</p>
						</div>
					</div>
					<div class="flex gap-2 items-center">
						<div class="bg-gray-100/90 size-12 flex items-center justify-center rounded-md">
							<i class="fas fa-bed text-cornflower-blue text-xl"></i>
						</div>
						<div>
							<p class="text-sm text-gray-600">Dormitorios</p>
							<p class="font-bold text-midnight-blue">{property?.rooms}</p>
						</div>
					</div>
					<div class="flex gap-2 items-center">
						<div class="bg-gray-100/90 size-12 flex items-center justify-center rounded-md">
							<i class="fas fa-bath text-cornflower-blue text-xl"></i>
						</div>
						<div>
							<p class="text-sm text-gray-600">Baños</p>
							<p class="font-bold text-midnight-blue">{property?.bathrooms}</p>
						</div>
					</div>
					<div class="flex gap-2 items-center">
						<div class="bg-gray-100/90 size-12 flex items-center justify-center rounded-md">
							<i class="fas fa-building text-cornflower-blue text-xl"></i>
						</div>
						<div>
							<p class="text-sm text-gray-600">Pisos</p>
							<p class="font-bold text-midnight-blue">{property?.floors}</p>
						</div>
					</div>
				</div>
			</div>

			<!-- Description -->
			<div class="mb-12">
				<h2 class="text-lg md:text-xl font-bold text-midnight-blue mb-4">Descripción de la propiedad</h2>
				<div class="prose max-w-none">
					<p class="mb-4 text-gray-700">{property?.description}</p>
				</div>
			</div>

			<!-- Highlights -->
			<div class="mb-12">
				<h2 class="text-lg md:text-xl font-bold text-midnight-blue mb-4">Características destacadas</h2>
				<div class="flex flex-wrap gap-3">
					{
						property?.highlights.map((highlight) => (
							<div class="feature-badge flex items-center text-gray-700">
								<div class="bg-cornflower-blue/15 flex justify-center items-center h-10 aspect-square p-2 rounded-full mr-4">
									<i class="fas fa-check text-cornflower-blue str" />
								</div>
								{highlight}
							</div>
						))
					}
				</div>
			</div>

			<div class="bg-gray-50 border-l-4 border-l-gray-300 px-4 py-6 mb-4 italic">
				<p class="font-medium text-gray-700">{property?.tagline}</p>
			</div>

			<div class="mt-8">
				<h2 class="text-lg md:text-xl font-bold text-midnight-blue mb-4">Ubicación</h2>
				<div class="w-full mt-8 rounded-xl overflow-hidden bg-gray-100">
					<iframe
						width="100%"
						height="350"
						style="border:0;"
						src={property?.mapIframeUrl}
					></iframe>
				</div>
			</div>
		</div>

		<!-- Sidebar -->
		<div class="w-full max-w-md mx-auto">
			<div class="bg-white rounded-lg border-2 border-gray-100/80 p-6 mb-8 sticky lg:top-28">
				<h2 class="text-lg md:text-xl font-bold text-midnight-blue mb-4">Contáctanos</h2>
				<p class="text-gray-700 mb-4 text-sm">
					Si tienes alguna pregunta o deseas más información sobre esta propiedad, no dudes en contactarnos.
				</p>
				<a
					href={getWhatsappLink(message, url)}
					target="_blank"
					rel="noopener noreferrer"
					class="inline-flex justify-center items-center w-full gap-2 bg-[#25D366] text-white font-medium px-6 py-3 rounded hover:bg-green-600 transition"
				>
					<i class="fab fa-whatsapp text-xl"></i>
					WhatsApp
				</a>
			</div>
			<div class="flex items-center my-6 sticky lg:top-28 -z-10">
				<div class="flex-grow h-px bg-gray-100"></div>
				<span class="mx-4 text-gray-400 font-semibold select-none">ó</span>
				<div class="flex-grow h-px bg-gray-100"></div>
			</div>
			<div class="bg-white rounded-lg border-2 border-gray-100/80 p-6 sticky lg:top-28">
				<form class="space-y-4">
					<div>
						<label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nombre completo</label>
						<input
							type="text"
							id="name"
							class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded focus:ring-2 focus:ring-[#5193e6] focus:border-[#5193e6] placeholder:text-gray-300"
							placeholder="José Pérez"
						/>
					</div>
					<div>
						<label for="email" class="block text-sm font-medium text-gray-700 mb-1"
							>Correo electrónico</label
						>
						<input
							type="email"
							id="email"
							class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded focus:ring-2 focus:ring-[#5193e6] focus:border-[#5193e6] placeholder:text-gray-300"
							placeholder="ejemplo@gmail.com"
						/>
					</div>
					<div>
						<label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
						<input
							type="tel"
							id="phone"
							class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded focus:ring-2 focus:ring-[#5193e6] focus:border-[#5193e6] placeholder:text-gray-300"
							placeholder="999 999 999"
						/>
					</div>
					<div>
						<label for="message" class="block text-sm font-medium text-gray-700 mb-1">Mensaje</label>
						<textarea
							id="message"
							rows="3"
							class="w-full px-4 py-2 border border-gray-300 rounded bg-gray-50 focus:ring-2 focus:ring-[#5193e6] focus:border-[#5193e6] placeholder:text-gray-300"
							placeholder="Escribe tu mensaje aquí"></textarea>
					</div>
					<Button icon="fas fa-paper-plane" class="w-full" variant="secondary" size="md">
						Enviar mensaje
					</Button>
				</form>
			</div>
		</div>
	</section>

	<div class="container h-16 w-full"></div>
</MainLayout>
