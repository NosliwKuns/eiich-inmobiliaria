---
// src/pages/propiedades/[slug].astro
import MainLayout from "@core/layouts/MainLayout.astro"
import properties from "@features/properties/data/properties.json"
import { envConfig } from "src/config/env"

export async function getStaticPaths() {
	return properties.map((prop) => ({
		params: { slug: prop.slug },
	}))
}

const { slug } = Astro.params
const prts = properties.find((item) => item.slug === slug)

const phone = "51992096134" // Perú
const name = prts?.title
const url = `${envConfig?.clientUrl}/propiedades/${prts?.slug}`
const mensaje = encodeURIComponent(`
Hola, estoy interesado en este inmueble:
${name}

${url}
`)
const link = `https://wa.me/${phone}?text=${mensaje}`

console.log(envConfig)
---

<MainLayout title="Propiedades">
	<div class="h-14 lg:h-[66px] sticky top-0 w-full bg-midnight-blue"></div>

	<div class="container py-4 overflow-hidden">
		<nav class="flex" aria-label="Breadcrumb">
			<ol class="inline-flex items-center space-x-1 md:space-x-3">
				<li class="inline-flex items-center">
					<a
						href="/"
						class="inline-flex items-center text-sm font-medium text-[#5193e6] hover:text-[#0c2647]"
					>
						<i class="fas fa-home mr-2"></i>Inicio
					</a>
				</li>
				<li>
					<div class="flex items-center">
						<i class="fas fa-chevron-right text-gray-400 mx-2"></i>
						<a
							href="/propiedades"
							class="ml-1 text-sm font-medium text-[#5193e6] hover:text-[#0c2647] md:ml-2"
						>
							Propiedades
						</a>
					</div>
				</li>
				<li aria-current="page">
					<div class="flex items-center">
						<i class="fas fa-chevron-right text-gray-400 mx-2"></i>
						<span
							class="ml-1 text-sm font-medium text-gray-500 md:ml-2 max-w-[150px] md:max-w-full truncate block"
						>
							{prts?.title}
						</span>
					</div>
				</li>
			</ol>
		</nav>
	</div>

	<!-- Gallery -->
	<section class="container mb-8">
		<div id="gallery-grid" class="rounded-xl overflow-hidden">
			<div class="gallery-main bg-cover bg-center">
				<a href={prts?.images[0]} class="block h-full w-full" target="_blank">
					<img src={prts?.images[0]} alt="" class="h-full w-full object-cover" />
				</a>
			</div>
			{
				prts?.images.slice(1, 5).map((img, i) => (
					<div class={`gallery-thumbnail ${["one", "two", "three", "four"][i]} relative object-cover`}>
						<a
							href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/1/img-2500.jpg"
							class="block h-full w-full"
							data-pswp-width="1875"
							data-pswp-height="2500"
							target="_blank"
						>
							<img src={prts?.images[0]} class="h-full w-full object-cover" alt="" />
						</a>
					</div>
				))
			}
		</div>
		<div class="mt-4 flex justify-center">
			<button class="text-[#5193e6] hover:text-[#0c2647] font-medium flex items-center">
				<i class="fas fa-images mr-2"></i>Ver todas las fotos ({prts?.images.length})
			</button>
		</div>
	</section>

	<!-- Property Info -->
	<section class="container grid grid-cols-1 lg:grid-cols-[1fr_380px] gap-8">
		<div class="l2">
			<!-- Title and location -->
			<div class="mb-6">
				<h1 class="text-3xl md:text-4xl font-bold text-[#0c2647] mb-2">{prts?.title}</h1>
				<div class="flex items-center text-gray-600">
					<i class="fas fa-map-marker-alt text-[#fe7f32] mr-2"></i>
					<span>{prts?.location}</span>
				</div>
			</div>

			<!-- Highlights -->
			<div class="bg-[#f4efea] rounded-xl p-6 mb-8 shadow-sm">
				<div class="grid grid-cols-2 md:grid-cols-4 gap-4">
					<div class="text-center">
						<div
							class="bg-[#5193e6] bg-opacity-20 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2"
						>
							<i class="fas fa-ruler-combined text-white text-xl"></i>
						</div>
						<p class="text-sm text-gray-600">Área total</p>
						<p class="font-bold text-[#0c2647]">{prts?.area} m²</p>
					</div>
					<div class="text-center">
						<div
							class="bg-[#5193e6] bg-opacity-20 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2"
						>
							<i class="fas fa-bed text-white text-xl"></i>
						</div>
						<p class="text-sm text-gray-600">Dormitorios</p>
						<p class="font-bold text-[#0c2647]">{prts?.rooms}</p>
					</div>
					<div class="text-center">
						<div
							class="bg-[#5193e6] bg-opacity-20 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2"
						>
							<i class="fas fa-bath text-white text-xl"></i>
						</div>
						<p class="text-sm text-gray-600">Baños</p>
						<p class="font-bold text-[#0c2647]">{prts?.bathrooms}</p>
					</div>
					<div class="text-center">
						<div
							class="bg-[#5193e6] bg-opacity-20 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2"
						>
							<i class="fas fa-building text-white text-xl"></i>
						</div>
						<p class="text-sm text-gray-600">Pisos</p>
						<p class="font-bold text-[#0c2647]">{prts?.floors}</p>
					</div>
				</div>
			</div>

			<!-- Description -->
			<div class="mb-8">
				<h2 class="text-2xl font-bold text-[#0c2647] mb-4">Descripción de la propiedad</h2>
				<div class="prose max-w-none">
					<p class="mb-4 text-gray-700">{prts?.description}</p>
				</div>
			</div>

			<!-- Features -->
			<div class="mb-8">
				<h2 class="text-2xl font-bold text-[#0c2647] mb-4">Características destacadas</h2>
				<div class="flex flex-wrap gap-3">
					{
						prts?.highlights.map((highlight) => (
							<div class="feature-badge flex items-center text-gray-700">
								<div class="bg-cornflower-blue/20 flex justify-center items-center h-10 aspect-square text-white p-2 rounded-full mr-4 shadow-md">
									<i class="fas fa-check text-cornflower-blue" />
								</div>
								{highlight}
							</div>
						))
					}
				</div>
			</div>

			<div class="bg-white-smoke px-4 py-6 mb-4">
				<p class="font-semibold text-lg">{prts?.tagline}</p>
			</div>

			<div class="flex flex-col md:flex-row items-center justify-between gap-2">
				<p class="font-medium text-center md:text-left">
					{prts?.contact.message}
				</p>
				<a
					href={link}
					target="_blank"
					rel="noopener noreferrer"
					class="inline-flex items-center gap-2 bg-midnight-blue text-white font-semibold px-6 py-3 rounded-lg hover:bg-[#0c2647]/90 transition"
				>
					<i class="fab fa-whatsapp text-xl"></i>
					WhatsApp
				</a>
			</div>
		</div>

		<!-- Sidebar -->
		<div class="w-full max-w-md mx-auto">
			<div class="bg-white rounded-xl shadow-lg p-6 sticky top-28">
				<div class="text-center mb-6">
					<p class="text-gray-600 mb-1">Precio de venta</p>
					<p class="text-3xl font-bold text-[#0c2647]">{prts?.price}</p>
				</div>

				<form class="space-y-4">
					<div>
						<label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nombre completo</label>
						<input
							type="text"
							id="name"
							class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#5193e6] focus:border-[#5193e6]"
						/>
					</div>
					<div>
						<label for="email" class="block text-sm font-medium text-gray-700 mb-1"
							>Correo electrónico</label
						>
						<input
							type="email"
							id="email"
							class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#5193e6] focus:border-[#5193e6]"
						/>
					</div>
					<div>
						<label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
						<input
							type="tel"
							id="phone"
							class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#5193e6] focus:border-[#5193e6]"
						/>
					</div>
					<div>
						<label for="message" class="block text-sm font-medium text-gray-700 mb-1">Mensaje</label>
						<textarea
							id="message"
							rows="3"
							class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#5193e6] focus:border-[#5193e6]"
						></textarea>
					</div>
					<button
						type="submit"
						class="w-full bg-[#fe7f32] hover:bg-[#e6732d] text-white font-bold py-3 px-6 rounded-lg transition shadow-md hover:shadow-lg"
					>
						<i class="fas fa-paper-plane mr-2"></i>Enviar mensaje
					</button>
				</form>
			</div>
		</div>
	</section>

	<div class="container h-16 w-full"></div>
</MainLayout>

<script>
	import PhotoSwipeLightbox from "photoswipe/lightbox"
	import "photoswipe/style.css"

	const lightbox = new PhotoSwipeLightbox({
		gallery: "#gallery-grid",
		children: "a",
		pswpModule: () => import("photoswipe"),
	})
	lightbox.init()
</script>

<style>
	#gallery-grid {
		display: grid;
		grid-template-columns: 50% 25% 25%;
		grid-template-rows: repeat(2, 1fr);
		gap: 8px;
		height: 500px;
	}

	.gallery-main {
		grid-row: 1 / span 2;
	}

	@media (max-width: 1000px) {
		.gallery-grid {
			grid-template-columns: 60% 40%;
			grid-template-rows: repeat(2, 1fr);
		}

		.gallery-main {
			grid-row: 1 / span 2;
		}

		.gallery-thumbnail.three,
		.gallery-thumbnail.four {
			display: none;
		}
	}

	@media (max-width: 840px) {
		.gallery-grid {
			grid-template-columns: 70% 30%;
			grid-template-rows: repeat(3, 1fr);
		}

		.gallery-main {
			grid-row: 1 / span 3;
		}

		.gallery-thumbnail.three {
			display: block;
		}
	}

	@media (max-width: 600px) {
		.gallery-grid {
			grid-template-columns: 1fr 1fr 1fr;
			grid-template-rows: 300px 100px;
			height: auto;
		}

		.gallery-main {
			grid-column: 1 / span 3;
			grid-row: 1;
		}
	}
</style>
